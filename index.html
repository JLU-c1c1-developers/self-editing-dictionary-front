<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>idictionary</title>
		<link rel="stylesheet" href="css/layout.css" />
		<link rel="icon" href="img/猫爪.png">
	</head>
	<body  background="./img/cat.jpeg" style="background-repeat: no-repeat;background-size: 100% 100%">

		<div class="hmask" style="display: none;">
			<div class="hmask-confirm">
				<div class="cross">
					X
				</div>
				<div class="tips tips-help">
					<p>网页帮助：本网页是一个在线的单词查询以及积累平台，具有查询单词，构建词典（即积累单词），以及与他人互享词典等功能。在基于日常生活常用单词的范围与频率下，通过满足对日常单词的查询，积累的需求，实现对日常单词的巩固积累，从而提高自身特定语境下的英语交流能力，从而满足日常生活的需求。
						本王网页由宣传界面，登录、注册界面，词典界面，以及个人主页构成。下面将对其涉及理念及功能进行说明：</p>
					<p>一，注册，登录界面</p>
					<p>1．页面说明</p>
						<p>（1）登录，注册界面分别完成用户的登录，注册功能，同时支持对分享词典的阅读查看</p>
					<p>2．页面帮助</p>
						<p>（1）登录：登录时按照提示，输入已注册用户正确的的电话，密码，点击登录即可，登录后跳转词典界面，若为注册本账户，可通过注册页先完成注册</p>
						<p>（2）注册：注册时，按照提示，输入电话，昵称，密码，并确认密码，即可完成注册。</p>
					<p>二，词典界面</p>
					<p>1．页面说明</p>
						<p>（1）词典界面即网页的主页面，可以在此检索词典，查看他人的词典，同时，也有机会中此看到自己的分享的词典。</p>
					<p>2．页面帮助</p>
						<p>（1）词典检索：本词典主要支持通过词典名称，作者名称以及二者结合的方式进行检索</p>
						<p>（2）词典查看：通过点击词典主体实现对词典的查看。</p>
					<p>三，个人主页</p>
						<p>1．页面说明</p>
						<p>（1）个人主页主要包括个人资料，我的词典，以及新建词典三个板块</p>
						<p>2．页面帮助</p>
						<p>（1）个人资料：通过点击个人资料进入个人资料页面，可以查看个人资料。通过页面下方的修改按钮，还能实现对个人资料的修改</p>
						<p>（2）我的词典：通过点击我的词典进入我的词典页面，我的词典页面收藏了所有自己创建的词典，可以通过点击词典主体对词典进行浏览，点击下方的删除实现对词典的删除。</p>
						<p>（3）新建词典：通过点击新建词典进入新建词典页面，按照提示，输入词典名字，词典继承，点击页面下方的新建词典按钮即可实现词典的建立。</p>
					<p>--附：本网页由：李唯聪，陈哲楷，刘俊宏，陈园共同完成。由于时间匆忙，网页尚有很多不足的地方，欢迎各位发现反馈，予以指正。</p>
				</div>
				<button class="submit submit-help">确认</button>
			</div>
		</div>

		<div class="wrapper">
			<div class="first-line">
				<a class="first-line-back" style="background:url(img/logo.png) no-repeat;background-size: 70%;border-bottom: 1px solid;background-position: 1.5rem 1rem;" ></a>
				
				<div class="first-line-options">
					<button class="first-line-option option-login option-form" value="login">登录</button>
					<button class="first-line-option option-register option-form" value="register">注册</button>
					<button class="first-line-option option-retrieval  option-form" value="retrieval">检索辞典</button>
					<button class="first-line-option option-homepage">个人主页</button>
					<button class="first-line-option option-help">辞典帮助</button>
					<div class="option-space"></div>
					<button class="first-line-option option-logout">退出登录</button>
				</div>
				
			</div>
			<div class="second-line">
				<!-- 第二列用户信息 -->
				<div class="second-line-admin" >
					<div class="second-line-admin-pic"></div>
					<p class="second-line-admin-name"></p>
				</div>
				
				<!-- 第二列表单信息 -->
				<div class="second-line-form">
					<!-- 登录表单 -->
					<div class="second-line-form-login">
						<h3>用户登录</h3>
						<input type="text" placeholder="电话" class="form-login-phone">
						<input type="password" placeholder="密码" class="form-login-password">
						<button type="button" class="submit-login">登录</button>
					</div>
					
					<!-- 注册表单 -->
					<div class="second-line-form-register">
						<h3>用户注册</h3>
						<input type="text" placeholder="电话" class="form-register-phone">
						<input type="text" placeholder="昵称" class="form-register-nickname">
						<input type="password" placeholder="密码" class="form-register-password">
						<input type="password" placeholder="确认密码" class="form-register-password-rpt">
						<button type="button" class="submit-register">注册</button>
					</div>
					
					<!-- 检索表单 -->
					<div class="second-line-form-retrieval">
						<h3>辞典检索</h3>
						<input type="text" placeholder="辞典名称" class="form-retrieval-name">
						<input type="text" placeholder="作者名称" class="form-retrieval-nickname">
						<button type="button" class="submit-retrieval">查找</button>
					</div>
				</div>
			</div>
			<div class="message">
				<div class="message-title">
					<h2 class="message-title-content">《实用工具-自编辑辞典v1.0》</h2>
					<h4 class="message-title-content">--吉林大学2119级网页设计小组LCLC开发--</h4>
				</div>
			</div>
			<div class ="book">
				<div class="book-wrapper"></div>
				<div class="book-option">
					<button type="button" class="prev">上一页</button>
					<span></span>
					<button type="button" class="next">下一页</button>
				</div>
			</div>
		</div>
	</body>
</html>
<script src="jquery-3.5.1.js"></script>
<script src="commen.js"></script>

<script>
	
	var datas = {
		retName:'',
		retNickname:'',
		retPage:1,
		totPage:0
	};
	$('.option-homepage').click(function(){
		location.href='home.html';
	})
	//处理第一列点击按钮事件
	$('.option-form').click(function(){
		
		var flag = $(this).hasClass('option-selected');
		
		//取消所有按钮选中状态
		$('.option-form').removeClass('option-selected');
		hideAllForm();
		
		if(!flag){//如果被选中的不是自己，则切换
			$(this).addClass('option-selected');
			showForm($(this).attr('value'));
		}
	})
	
	//处理登录事件
	$('.submit-login').click(login);
	
	//处理登出事件
	$('.option-logout').click(logout);
	
	//处理注册事件
	$('.submit-register').click(register);
	
	//处理上一页事件
	$('.book-option>.prev').click(function(){
		if(datas.retPage <= 1){
			return;
		}
		datas.retPage--;
		getBillList();
	})
	
	//处理下一页事件
	$('.book-option>.next').click(function(){
		if(datas.retPage >= datas.totPage){
			return;
		}
		datas.retPage++;
		getBillList();
	})
	
	//处理检索事件
	$('.submit-retrieval').click(function(){
		datas.retPage = 1;
		datas.retName = $('.form-retrieval-name').val();
		datas.retNickname = $('.form-retrieval-nickname').val();
		getBillList();
	})
	
	//刷新用户登录信息
	function refreshUserInfo(){
		hideAllForm();
		if(sessionStorage.getItem('token') == null){//用户未登录
			
			$('.option-homepage').hide();
			$('.option-logout').hide();
			
			$('.option-login').show();
			$('.option-register').show();
			
			$('.second-line-admin-pic').hide();
			$('.second-line-admin-name').text('【未登录】');
			
		}else{
			$('.option-homepage').show();
			$('.option-logout').show();
			
			$('.option-login').hide();
			$('.option-register').hide();
			
			//获取用户信息
			$.ajax({
				url:'http://60.205.211.19:2119/user/loginInfo',
				type:'get',
				headers:{
					Authorization:sessionStorage.getItem('token')
				},
				xhrFields:{
					withCredentials:true
				},
				success:function(res){
					if(res.code == 200){
						$('.message-selfpage').show();
						$('.second-line-admin-pic').show();
						$('.second-line-admin-name').text(res.data.nickname);
						$('.second-line-admin-pic').css('background-color','rgb(' + res.data.icon + ')');
					}else{
						// alert(res.message)
						$('.second-line-admin-pic').hide();
						$('.second-line-admin-name').text('【未登录】');
					}
				}
			})
		}
	}
	
	//用户登出
	function logout(){
		$.ajax({
			url:'http://60.205.211.19:2119/user/logout',
			type:'get',
			headers:{
				Authorization:sessionStorage.getItem('token')
			},
			xhrFields:{
				withCredentials:true
			},
			success:function(res){
				if(res.code == 200){
					alert('注销成功')
					sessionStorage.removeItem('token');
					refreshUserInfo();
				}else{
					alert(res.message)
				}
			}
		})
	}
	
	//用户登录
	function login(){
		let phone = $('.form-login-phone').val();
		let password = $('.form-login-password').val();
		
		$.ajax({
			url:'http://60.205.211.19:2119/user/login',
			type:'post',
			data:{
				phone:phone,
				password:password
			},
			headers:{
				Authorization:sessionStorage.getItem('token')
			},
			xhrFields:{
				withCredentials:true
			},
			success:function(res){
				if(res.code == 200){
					alert('登录成功');
					sessionStorage.setItem('token',res.data);
					
					refreshUserInfo();
				}else{
					alert('登录失败:' + res.message);
				}
			}
		})
	}
	
	//用户注册
	function register(){
		let phone = $('.form-register-phone').val();
		let password = $('.form-register-password').val();
		let passwordRpt = $('.form-register-password-rpt').val();
		let nickname = $('.form-register-nickname').val();
		
		if(password != passwordRpt){
			alert('两次密码不一致，请检查');
			return;
		}
		
		$.ajax({
			url:'http://60.205.211.19:2119/user/register',
			type:'post',
			data:{
				nickname:nickname,
				phone:phone,
				password:password
			},
			success:function(res){
				if(res.code == 200){
					alert('注册成功')
					refreshUserInfo();
					showForm('login');
				}else{
					alert('注册失败:' + res.message);
				}
			}
		})
	}
	
	//隐藏所有表单
	function hideAllForm(){
		$('.second-line-form div').hide();
	}
	
	//显示指定表单
	function showForm(name){
		$('.second-line-form-' + name).show();
		$('.second-line-form-' + name + '>input').val('');
	}
	
	//获取词典列表
	function getBillList(){
		
		
		$.ajax({
			url:'http://60.205.211.19:2119/bill/getList',
			type:'GET',
			async:false,
			data:{
				name:datas.retName,
				user:datas.retNickname,
				page:datas.retPage
			},
			success:function(res){
				
				if(res.code != 200){
					// alert('获取辞典出错了...');
					console.log(res);
					return;
				}
				
				datas.totPage = res.data.pages
				datas.retPage = res.data.currPage
				
				$('.book-option>button').removeAttr('disabled');
				if(datas.totPage == datas.retPage){
					$('.book-option>.next').attr('disabled','');
				}
				if(datas.retPage == 1){
					$('.book-option>.prev').attr('disabled','');
				}
				$('.book-option>span').text(res.data.currPage + '/' + res.data.pages);
				
				let book = $('.book-wrapper').empty();
				let data = res.data.list;
				for(let i = 0;i < data.length;i++){
					let dirt = $('<div class="book-dirt" onclick="toPage(\'./dict.html?bId=' + data[i].id + '\')"></div>')
					let title = $('<div class="book-dirt-word">' + data[i].name + '<br><span>单词数:' + data[i].wordCount + '</span></div>');
					let description = $('<div class="book-dirt-summary">' + data[i].introduction + '</div>');
					let usr = $('<div class="book-dirt-share">分享来自：<span>' + data[i].user.nickname + '</span></div>');
					console.log(title);
					dirt.append(title).append(description).append(usr);
					book.append(dirt);
				}
				
			}
		})
	}
	
	//词典帮助点击事件
	$('.option-help').click(function(){
		// alert(123);
		$('.hmask').fadeIn(200);
		
		//隐藏组件
		$('.hmask-confirm>.tips').hide();
		$('.hmask-confirm>.submit').hide();
		
		//显示对应组件
		$('.tips-help').show();
		$('.submit-help').show();
	})

	//关闭词典帮助点击事件
	$('.cross').click(function(){
		// alert(123);
		$('.hmask').fadeOut(200);
		
		//隐藏组件
		$('.hmask-confirm>.tips').hide();
		$('.hmask-confirm>.submit').hide();
		
		//显示对应组件
		$('.tips-help').hide();
		$('.submit-help').hide();
	})

	//确认词典帮助点击事件
	$('.submit-help').click(function(){
		// alert(123);
		$('.hmask').fadeOut(200);
		
		//隐藏组件
		$('.hmask-confirm>.tips').hide();
		$('.hmask-confirm>.submit').hide();
		
		//显示对应组件
		$('.tips-help').hide();
		$('.submit-help').hide();
	})

	//页面初始事件
	$(document).ready(function(){
		$('.second-line-login').hide();
		$('.second-line-register').hide();
		
		getBillList()
		
		refreshUserInfo();
		
		hideAllForm();
	})
	function toPage(href){
		document.location.href = href;
	}
	
	
</script>